<script language="Javascript">
  var base_path = "http://wiki.roji.net/";
  var index_wikiname = "lyrics";

  function render(data) {
      var contents_div = document.getElementById("main");
      //console.log(data);
      processed_data = [];
      exploded_data = data.split("\n");

      exploded_data.forEach(function (line) {

          function replacement(match, p1, offset, string) {
              var filename = p1.replace(":", "/").replace(/ /g, "_").replace(/[\(\)]/g, "").toLowerCase();
              return "<a href=\"#" + filename +"\">" + filename + "</a>";
          }
          console.log("line: ", line);
          if (line.search("\\[\\[")) {
              var re = /\[\[(.*)\]\]/;
              line = line.replace(re, replacement);
          }
          processed_data.push(line);
      })
      
      contents_div.innerHTML = processed_data.join("<br>\n");
  }

  function load_data(wiki_name) {
      xmlhttp = new XMLHttpRequest();
      filename = wiki_name.replace(":", "/").replace(/ /g, "_") + ".txt";
      filename = filename.toLowerCase();
      console.log("Opening filename:" + filename);
      xmlhttp.open("GET", base_path + filename, false);
      xmlhttp.send(null);
      return xmlhttp.responseText;
  }

  function show(filename) {
      var data = load_data(filename);
      
      render(data);
  }

  function init() {
      wikiname = window.location.hash || index_wikiname;
      show(wikiname.replace(/^#/, ""));
  }
  window.onhashchange = init;

</script>

<body onLoad="init()">
    <div id="main">
        Dummy
    </div>
</body>
